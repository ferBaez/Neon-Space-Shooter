<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- --- SEO & AEO --- -->
    <title>Neon Space Shooter | Juego Arcade Gratis</title>
    <meta name="description" content="Juego arcade de naves espaciales. Dispara y esquiva en este cl√°sico estilo ne√≥n. Controles t√°ctiles optimizados para m√≥vil.">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Ferbaez">
    
    <link rel="canonical" href="https://ferbaez.github.io/Neon-Space-Shooter/">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">

    <!-- --- OPEN GRAPH --- -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Neon Space Shooter üöÄ">
    <meta property="og:description" content="Juego arcade de naves. ¬°Juega ahora en tu m√≥vil o PC!">
    <meta property="og:site_name" content="Neon Space Shooter">
    <meta property="og:url" content="https://ferbaez.github.io/Neon-Space-Shooter/">
    
    <!-- IMAGEN PREVIA -->
    <meta property="og:image" content="https://images.unsplash.com/photo-1551103782-8ab07afd45c1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630&q=80">
    <meta property="og:image:secure_url" content="https://images.unsplash.com/photo-1551103782-8ab07afd45c1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630&q=80">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Retro Arcade Space Shooter">

    <!-- --- TWITTER CARDS --- -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Neon Space Shooter">
    <meta name="twitter:description" content="¬°Juego arcade de naves retro! Juega gratis aqu√≠.">
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1551103782-8ab07afd45c1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630&q=80">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Neon Space Shooter",
      "applicationCategory": "GameApplication",
      "operatingSystem": "Any",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
      "description": "Videojuego de disparos espaciales estilo arcade retro con controles t√°ctiles.",
      "genre": ["Arcade", "Shooter"],
      "url": "https://ferbaez.github.io/Neon-Space-Shooter/"
    }
    </script>

    <!-- Fuente -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-blue: #0ff;
            --neon-pink: #f0f;
            --neon-green: #0f0;
            --neon-red: #f00;
            --neon-yellow: #ff0;
            --bg-color: #050505;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
            color: #fff;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Fondo general */
        #main-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        }

        /* ENVOLTORIO DEL JUEGO */
        #game-wrapper {
            position: relative;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
            transition: width 0.3s, height 0.3s;
            z-index: 1; /* Asegura que el juego est√© en una capa base */
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            border: 2px solid var(--neon-blue);
            box-sizing: border-box;
            background-color: rgba(0,0,0,0.85);
            box-shadow: 0 0 15px var(--neon-blue), inset 0 0 20px rgba(0, 255, 255, 0.2);
        }

        /* Capa UI dentro del juego */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 10;
        }

        .hud-header {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        .hud-text {
            font-size: 14px;
            text-shadow: 0 0 5px var(--neon-blue);
        }

        #score-display { color: var(--neon-yellow); }
        #lives-display { color: var(--neon-green); }

        #info-btn {
            align-self: flex-end;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            cursor: pointer;
            pointer-events: auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- FOOTER --- */
        #game-footer {
            position: fixed;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 10px;
            color: #888;
            z-index: 200;
            pointer-events: none; /* Para no bloquear clics en el juego si se superpone */
            font-family: sans-serif; /* Fuente legible para el copyright */
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #game-footer a {
            color: var(--neon-blue);
            text-decoration: none;
            pointer-events: auto; /* Permitir clic en enlaces */
            transition: color 0.3s;
            font-weight: bold;
        }

        #game-footer a:hover {
            color: var(--neon-pink);
            text-shadow: 0 0 5px var(--neon-pink);
        }

        /* Separador vertical */
        .footer-sep { margin: 0 5px; color: #555; }

        /* --- CONTROLES M√ìVILES (ESTILO BASE) --- */
        #mobile-controls {
            display: none; /* Se activa con media queries */
            width: 100%;
            height: 160px; /* Altura por defecto en vertical */
            padding: 20px;
            box-sizing: border-box;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            margin-top: 10px;
        }

        .control-group {
            display: flex;
            gap: 20px;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            background: rgba(0, 255, 255, 0.15); /* Un poco m√°s visible */
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            color: var(--neon-blue);
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
            user-select: none;
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-blue);
            backdrop-filter: blur(2px);
        }

        .control-btn:active, .control-btn.active {
            background: var(--neon-blue);
            color: #000;
            transform: scale(0.95);
        }

        #btn-shoot {
            border-color: var(--neon-red);
            color: var(--neon-red);
            box-shadow: 0 0 10px var(--neon-red);
            width: 80px;
            height: 80px;
            font-size: 30px;
        }
        
        #btn-shoot:active, #btn-shoot.active {
            background: var(--neon-red);
            color: #fff;
        }

        /* Modales */
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border: 3px solid var(--neon-pink);
            box-shadow: 0 0 30px var(--neon-pink);
            z-index: 50;
            width: 85%;
            max-width: 400px;
            border-radius: 8px;
            display: none;
        }
        
        #start-screen { display: block; }
        
        h1 { color: var(--neon-pink); font-size: 20px; margin-bottom: 20px; line-height: 1.5; text-shadow: 0 0 10px var(--neon-pink); }
        p, li { font-size: 10px; color: #ccc; line-height: 1.6; margin-bottom: 15px; }
        .enter-hint { font-size: 10px; color: #888; margin-top: 15px; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .btn {
            background: transparent; border: 2px solid var(--neon-blue); color: var(--neon-blue);
            padding: 12px 20px; font-family: 'Press Start 2P', cursive; font-size: 12px; cursor: pointer;
            text-shadow: 0 0 5px var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue);
            width: 100%; margin-top: 10px;
        }
        .btn:hover { background: var(--neon-blue); color: #000; }

        /* --- RESPONSIVIDAD AVANZADA (VISIBILIDAD GARANTIZADA) --- */
        
        /* Regla universal para activar controles en m√≥viles/tablets (ancho menor a 1024px) O dispositivos t√°ctiles */
        @media (max-width: 1024px), (hover: none) and (pointer: coarse) {
            #mobile-controls { display: flex !important; }
        }

        /* M√≥vil Vertical (Portrait) - Los controles se quedan abajo */
        @media (max-width: 1024px) and (orientation: portrait) {
            #main-container {
                justify-content: flex-start;
                padding-top: 20px;
            }
            #game-footer {
                bottom: 5px;
                background: rgba(0,0,0,0.8); /* Fondo para legibilidad si se superpone */
                padding: 5px 0;
                width: 100%;
            }
        }

        /* M√≥vil Horizontal (Landscape) - Los controles FLOTAN a los lados */
        @media (max-width: 1024px) and (orientation: landscape) {
            #main-container {
                flex-direction: row; 
                justify-content: center;
                padding: 0;
            }

            #mobile-controls {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0 50px 60px 50px; 
                pointer-events: none; 
                align-items: flex-end; 
                background: transparent;
            }

            .control-btn {
                pointer-events: auto; 
                opacity: 0.85; 
            }
            
            /* Ajuste de tama√±o para landscape */
            .control-btn { width: 65px; height: 65px; font-size: 22px; margin-bottom: 0; } 
            #btn-shoot { width: 75px; height: 75px; font-size: 28px; }
            
            /* Footer en landscape: peque√±o a la derecha o izquierda */
            #game-footer {
                font-size: 8px;
                bottom: 2px;
                text-align: center;
                width: 100%;
                text-shadow: 1px 1px 2px #000;
            }
        }
    </style>
</head>
<body>

    <div id="main-container">
        <!-- √Årea del Juego -->
        <div id="game-wrapper">
            <canvas id="gameCanvas"></canvas>

            <div id="ui-layer">
                <header class="hud-header">
                    <span id="score-display" class="hud-text">SCORE: 0</span>
                    <span id="lives-display" class="hud-text">LIVES: 3</span>
                </header>
                <button id="info-btn">?</button>
            </div>

            <!-- Modales -->
            <section id="start-screen" class="modal">
                <h1>NEON<br>SHOOTER</h1>
                <p>M√ìVIL: Usa los botones<br>PC: Flechas + Espacio</p>
                <button class="btn" id="start-btn">JUGAR</button>
                <div class="enter-hint">[ ENTER ]</div>
            </section>

            <section id="game-over-screen" class="modal">
                <h1 style="color: var(--neon-red);">GAME OVER</h1>
                <p>SCORE FINAL: <span id="final-score">0</span></p>
                <button class="btn" id="restart-btn">REINTENTAR</button>
            </section>

            <section id="info-screen" class="modal">
                <h2 style="color: var(--neon-yellow); font-size:14px; margin-bottom:15px;">AYUDA</h2>
                <div style="text-align: left; max-height: 150px; overflow-y: auto;">
                    <p>‚Ä¢ Mover: Flechas (Derecha)</p>
                    <p>‚Ä¢ Disparo: Bot√≥n Rojo (Izquierda)</p>
                    <p>‚Ä¢ Objetivo: Destruye todo</p>
                </div>
                <button class="btn" id="close-info-btn" style="border-color:var(--neon-red); color:var(--neon-red);">CERRAR</button>
            </section>
        </div>

        <!-- CONTROLES M√ìVILES -->
        <div id="mobile-controls">
            <!-- Izquierda: Disparo -->
            <button id="btn-shoot" class="control-btn">üî•</button>
            
            <!-- Derecha: Movimiento -->
            <div class="control-group">
                <button id="btn-left" class="control-btn">‚óÄ</button>
                <button id="btn-right" class="control-btn">‚ñ∂</button>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer id="game-footer">
        Todos los derechos reservados a <a href="https://studio--hitsterai.us-central1.hosted.app/es" target="_blank">Hitster Ai</a>
        <span class="footer-sep">|</span>
        <a href="mailto:baez@hitster.page">Cont√°ctanos</a>
    </footer>

    <script>
        // --- CONFIGURACI√ìN ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        const gameWrapper = document.getElementById('game-wrapper');
        
        // UI Elements
        const scoreDisplay = document.getElementById('score-display');
        const livesDisplay = document.getElementById('lives-display');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const infoScreen = document.getElementById('info-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        
        // Botones M√≥viles
        const btnLeft = document.getElementById('btn-left');
        const btnRight = document.getElementById('btn-right');
        const btnShoot = document.getElementById('btn-shoot');

        // Constantes Juego
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        const ASPECT_RATIO = GAME_WIDTH / GAME_HEIGHT;

        // Estado
        let gameState = 'START';
        let score = 0;
        let lives = 3;
        
        // Input Virtual
        let keys = {
            ArrowLeft: false,
            ArrowRight: false,
            Space: false,
            Enter: false
        };

        const COLORS = {
            blue: '#0ff', pink: '#f0f', green: '#0f0', 
            red: '#f00', yellow: '#ff0', white: '#fff'
        };

        // --- RESIZE INTELIGENTE ---
        function resizeGame() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            // Detectar si es m√≥vil basado en ancho o user agent/touch (simple)
            // Se considera m√≥vil si es < 1024px de ancho
            const isMobile = windowWidth <= 1024;
            const isPortrait = windowHeight > windowWidth;

            // Espacio reservado para controles:
            // Solo restamos altura si es m√≥vil y est√° en VERTICAL.
            // En horizontal, los controles flotan (overlay), as√≠ que usamos toda la altura.
            let controlsHeight = 0;
            if (isMobile && isPortrait) {
                controlsHeight = 160; // Altura del div #mobile-controls
            }

            const availableHeight = windowHeight - controlsHeight;
            const availableWidth = windowWidth;

            let newWidth = availableWidth;
            let newHeight = availableWidth / ASPECT_RATIO;

            if (newHeight > availableHeight) {
                newHeight = availableHeight;
                newWidth = newHeight * ASPECT_RATIO;
            }

            // Margen seguridad
            const scale = 0.96;
            gameWrapper.style.width = `${newWidth * scale}px`;
            gameWrapper.style.height = `${newHeight * scale}px`;

            canvas.width = GAME_WIDTH;
            canvas.height = GAME_HEIGHT;
        }

        window.addEventListener('resize', resizeGame);
        // Llamar resize un poco despu√©s por si el navegador tarda en rotar
        window.addEventListener('orientationchange', () => setTimeout(resizeGame, 200));
        resizeGame();

        // --- AUDIO ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume().catch(e=>{});
            if (gameState !== 'PLAYING' && type !== 'gameover') return;

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'shoot') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gainNode.gain.setValueAtTime(0.03, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'explosion') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(10, now + 0.2);
                gainNode.gain.setValueAtTime(0.08, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            } else if (type === 'gameover') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(100, now + 1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 1);
                osc.start(now); osc.stop(now + 1);
            }
        }

        // --- INPUT HANDLING ---
        // Teclado
        document.addEventListener('keydown', e => {
            if(keys.hasOwnProperty(e.code)) keys[e.code] = true;
            if((gameState==='START'||gameState==='GAMEOVER') && e.code==='Enter') initGame();
        });
        document.addEventListener('keyup', e => {
            if(keys.hasOwnProperty(e.code)) keys[e.code] = false;
        });

        // Controles T√°ctiles (Simulan Teclado)
        function setupTouchBtn(btn, code) {
            const activate = (e) => {
                e.preventDefault(); 
                keys[code] = true;
                btn.classList.add('active');
            };
            const deactivate = (e) => {
                e.preventDefault();
                keys[code] = false;
                btn.classList.remove('active');
            };

            // Soporte mixto mouse/touch para pruebas
            btn.addEventListener('touchstart', activate, {passive: false});
            btn.addEventListener('touchend', deactivate);
            btn.addEventListener('mousedown', activate);
            btn.addEventListener('mouseup', deactivate);
            btn.addEventListener('mouseleave', deactivate);
        }

        setupTouchBtn(btnLeft, 'ArrowLeft');
        setupTouchBtn(btnRight, 'ArrowRight');
        setupTouchBtn(btnShoot, 'Space');


        // --- ENTIDADES ---
        class Player {
            constructor() {
                this.width = 40; this.height = 40;
                this.x = GAME_WIDTH/2 - 20; this.y = GAME_HEIGHT - 70;
                this.speed = 8;
                this.color = COLORS.blue;
                this.lastShot = 0;
            }
            update() {
                // Movimiento exclusivo por teclas (f√≠sicas o virtuales)
                if (keys['ArrowLeft'] && this.x > 0) this.x -= this.speed;
                if (keys['ArrowRight'] && this.x < GAME_WIDTH - this.width) this.x += this.speed;

                let now = Date.now();
                if (keys['Space'] && now - this.lastShot > 200) {
                    projectiles.push(new Projectile(this.x, this.y, -12, COLORS.yellow, true));
                    projectiles.push(new Projectile(this.x+this.width, this.y, -12, COLORS.yellow, true));
                    playSound('shoot');
                    this.lastShot = now;
                }
            }
            draw() {
                ctx.shadowColor = this.color; ctx.shadowBlur = 15;
                ctx.strokeStyle = this.color; ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
                // Alas
                ctx.beginPath();
                ctx.moveTo(this.x, this.y+this.height);
                ctx.lineTo(this.x-10, this.y+this.height+10);
                ctx.stroke();
                ctx.moveTo(this.x+this.width, this.y+this.height);
                ctx.lineTo(this.x+this.width+10, this.y+this.height+10);
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
        }

        class Enemy {
            constructor(x, y, type) {
                this.x = x; this.y = y;
                this.width = 30; this.height = 30;
                this.type = type;
                if(type===1) { this.color = COLORS.red; this.points = 50; }
                else if(type===2) { this.color = COLORS.pink; this.points = 30; }
                else { this.color = COLORS.green; this.points = 10; }
            }
            draw() {
                ctx.shadowColor = this.color; ctx.shadowBlur = 10;
                ctx.strokeStyle = this.color; ctx.lineWidth = 2;
                if(this.type===1) {
                    ctx.beginPath(); ctx.moveTo(this.x,this.y); 
                    ctx.lineTo(this.x+this.width,this.y); 
                    ctx.lineTo(this.x+this.width/2,this.y+this.height); ctx.closePath(); ctx.stroke();
                } else if(this.type===2) {
                    ctx.beginPath(); ctx.arc(this.x+15,this.y+15,15,0,Math.PI*2); ctx.stroke();
                } else {
                    ctx.strokeRect(this.x,this.y,this.width,this.height);
                }
                ctx.shadowBlur = 0;
            }
        }

        class Projectile {
            constructor(x, y, s, c, p) {
                this.x = x; this.y = y; this.speed = s; this.color = c; this.isPlayer = p;
                this.w = 4; this.h = 12; this.del = false;
            }
            update() {
                this.y += this.speed;
                if(this.y < -20 || this.y > GAME_HEIGHT+20) this.del = true;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.shadowColor = this.color; ctx.shadowBlur = 8;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.shadowBlur = 0;
            }
        }

        class Particle {
            constructor(x, y, c) {
                this.x = x; this.y = y; this.color = c;
                this.vx = (Math.random()-0.5)*8; this.vy = (Math.random()-0.5)*8;
                this.life = 1;
            }
            update() { this.x+=this.vx; this.y+=this.vy; this.life-=0.04; }
            draw() {
                ctx.globalAlpha = Math.max(0, this.life);
                ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, 3, 3);
                ctx.globalAlpha = 1;
            }
        }

        // --- GAME LOGIC ---
        let player;
        let enemies = [];
        let projectiles = [];
        let particles = [];
        let enemyDir = 1;
        
        function initGame() {
            score = 0; lives = 3; gameState = 'PLAYING';
            scoreDisplay.innerText = `SCORE: ${score}`;
            livesDisplay.innerText = `LIVES: ${lives}`;
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            player = new Player();
            projectiles = []; particles = [];
            initEnemies();
            if(audioCtx.state === 'suspended') audioCtx.resume();
        }

        function initEnemies() {
            enemies = [];
            let startX = (GAME_WIDTH - (8*50))/2;
            for(let r=0; r<4; r++) {
                for(let c=0; c<8; c++) {
                    let t = (r===0)?1:(r===1?2:3);
                    enemies.push(new Enemy(startX + c*50, 50 + r*50, t));
                }
            }
        }

        function checkCol(a, b) {
            return (a.x < b.x + (b.width||b.w) && a.x + (a.width||a.w) > b.x &&
                    a.y < b.y + (b.height||b.h) && a.y + (a.height||a.h) > b.y);
        }

        function animate() {
            ctx.fillStyle = 'rgba(5, 5, 5, 0.4)';
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            if (gameState === 'PLAYING') {
                player.update(); player.draw();

                let hitEdge = false;
                enemies.forEach(e => {
                    e.x += (1.5 + score*0.001) * enemyDir;
                    if(e.x <= 10 || e.x >= GAME_WIDTH-40) hitEdge = true;
                    
                    if (e.y + e.height >= player.y) {
                        lives = 0; livesDisplay.innerText = `LIVES: 0`;
                        gameState = 'GAMEOVER'; playSound('gameover');
                        gameOverScreen.style.display = 'block';
                        finalScoreDisplay.innerText = score;
                    }
                    e.draw();
                });
                if(hitEdge) { enemyDir *= -1; enemies.forEach(e => e.y+=20); }

                if(Math.random()<0.02 && enemies.length>0) {
                    let e = enemies[Math.floor(Math.random()*enemies.length)];
                    projectiles.push(new Projectile(e.x+15, e.y+30, 5, COLORS.red, false));
                }

                projectiles.forEach(p => p.update());
                projectiles = projectiles.filter(p => !p.del);
                projectiles.forEach(p => p.draw());

                particles.forEach(p => p.update());
                particles = particles.filter(p => p.life > 0);
                particles.forEach(p => p.draw());

                projectiles.forEach(p => {
                    if(p.isPlayer) {
                        enemies.forEach((e, i) => {
                            if(checkCol(p, e)) {
                                score += e.points; scoreDisplay.innerText = `SCORE: ${score}`;
                                for(let k=0;k<8;k++) particles.push(new Particle(e.x+15, e.y+15, e.color));
                                enemies.splice(i, 1); p.del = true; playSound('explosion');
                            }
                        });
                    } else {
                        if(checkCol(p, {x:player.x+10, y:player.y+10, w:20, h:20})) {
                            lives--; livesDisplay.innerText = `LIVES: ${lives}`;
                            p.del = true; playSound('explosion');
                            for(let k=0;k<10;k++) particles.push(new Particle(player.x+20, player.y+20, COLORS.blue));
                            if(lives<=0) { gameState = 'GAMEOVER'; playSound('gameover'); gameOverScreen.style.display='block'; finalScoreDisplay.innerText=score; }
                        }
                    }
                });

                if(enemies.length===0) initEnemies();
            }

            requestAnimationFrame(animate);
        }

        document.getElementById('start-btn').onclick = initGame;
        document.getElementById('restart-btn').onclick = initGame;
        document.getElementById('info-btn').onclick = () => { infoScreen.style.display='block'; gameState='PAUSED'; };
        document.getElementById('close-info-btn').onclick = () => { infoScreen.style.display='none'; gameState='PLAYING'; };

        animate();

    </script>
</body>
</html>
